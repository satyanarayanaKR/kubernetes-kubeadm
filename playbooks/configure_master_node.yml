---
- hosts: kubernetes-master-nodes
  vars_files:
    -  ../env_variables
  tasks:
    - name: Pulling images required for kubernetes cluster
      shell: kubeadm config images pull
    - name: Initializing cluster
      shell: kubeadm init --apiserver-advertise-address {{ad_addr}} --pod-network-cidr={{cidr_v}}
      register: output
    - name: Generating token
      copy: 
        content: "{{ output.stdout}}"
        dest: /root/file.txt
      delegate_to: localhost
    - name: Copying required files
      shell: |
        mkdir -p $HOME/.kube
        sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
        sudo chown $(id -u):$(id -g) $HOME/.kube/config
    - name: Install Network Add-on
      command: kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml

    
